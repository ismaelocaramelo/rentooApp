"use strict";function init(){getToken()?loggedInState():loggedOutState(),$("body").on("click",".logout",logout),$("body").on("click",".userslogin",usersLogin),$("body").on("click",".usersNew",usersNew),$("body").on("submit",".usersCreate",usersCreate),$("body").on("submit",".usersloginform",usersloginResponse),$("body").on("submit",".usersUpdateForm",usersUpdateResponse),$("body").on("submit",".usersUpdatePasswordForm",usersUpdateResponse)}function loggedInState(e){$("#button1").addClass("userindex").removeClass("userslogin"),$("#button2").addClass("logout").removeClass("usersNew").html("Log out"),e?($("#button1").html(e.username),getProfile(e._id)):getUserInfo(function(e){$("#button1").html(e.username),getProfile(e._id)})}function getProfile(e){$.ajax({url:API+"/users/"+e,beforeSend:function(e){setRequestHeader(e)}}).done(function(e){$("#container").html('\n      <form method="put" action="'+API+"/users/"+e._id+'" class="usersUpdateForm">\n        <div class="modal-header">\n          <h4 class="modal-title">Update Your Email</h4>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <label for="user_email">Email</label>\n            <input class="form-control" type="text" name="user[email]" id="user_email" value="'+e.email+'" placeholder="Email">\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n          <button type="submit" class="btn btn-primary">Save</button>\n        </div>\n      </form>\n      <form method="put" action="'+API+"/users/newpassword/"+e._id+'" class="usersUpdatePasswordForm">\n        <div class="modal-header">\n          <h4 class="modal-title">Update Your Password</h4>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <label for="user_newPassword">New Password</label>\n            <input class="form-control" type="password" name="user[newPassword]" id="user_newPassword" placeholder="New Password">\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n          <button type="submit" class="btn btn-primary">Save</button>\n        </div>\n      </form>')})}function loggedOutState(){$("#button1").addClass("userslogin").removeClass("userindex").html("Login"),$("#button2").addClass("usersNew").removeClass("logout").html("Sign up")}function logout(e){e.preventDefault(),$("#container").html(""),removeToken(),loggedOutState()}function usersNew(e){e&&e.preventDefault(),$(".modal-content").html('\n    <form method="post" action="'+API+'/register" class="usersCreate">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Welcome to Green Points</h4>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <label for="user_name">Name</label>\n          <input class="form-control" type="text" name="user[username]" id="user_name" placeholder="Name">\n        </div>\n        <div class="form-group">\n          <label for="user_email">Email</label>\n          <input class="form-control" type="text" name="user[email]" id="user_email" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <label for="user_password">Password</label>\n          <input class="form-control" type="password" name="user[password]" id="user_password" placeholder="Password">\n        </div>\n        <div class="form-group">\n          <label for="user_passwordConfirmation">Repeat password</label>\n          <input class="form-control" type="password" name="user[passwordConfirmation]" id="user_passwordConfirmation" placeholder="Repeat Password">\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n        <button type="submit" class="btn btn-primary">Save</button>\n      </div>\n    </form>'),$(".modal").modal("show")}function usersCreate(e){e&&e.preventDefault(),$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serialize()}).done(function(){$(".modal").modal("hide")})}function usersLogin(e){e&&e.preventDefault(),$(".modal-content").html('\n    <form method="post" action="'+API+'/login" class="usersloginform">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Login</h4>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <label for="user_email">Email</label>\n          <input class="form-control" type="text" name="user[email]" id="user_email" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <label for="user_password">Password</label>\n          <input class="form-control" type="password" name="user[password]" id="user_password" placeholder="Password">\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n        <button type="submit" class="btn btn-primary">Save</button>\n      </div>\n    </form>'),$(".modal").modal("show")}function usersloginResponse(e){e&&e.preventDefault(),$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serialize()}).done(function(e){$(".modal").modal("hide"),e.token&&(setToken(e.token),loggedInState(e.user))})}function usersUpdateResponse(e){e&&e.preventDefault(),$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serialize()}).done(function(e){showToast()})}function showToast(){var e=document.getElementById("snackbar");e.className="show",setTimeout(function(){e.className=e.className.replace("show","")},3e3)}function setRequestHeader(e){return e.setRequestHeader("Authorization","Bearer "+getToken())}function setToken(e){return window.localStorage.setItem("token",e)}function removeToken(){return window.localStorage.clear()}function getToken(){return window.localStorage.getItem("token")}function getUserInfo(e){$.ajax({url:"http://localhost:3000/users/token",beforeSend:function(e){setRequestHeader(e)}}).done(function(s){e(s)})}var $=$,API="http://localhost:3000";$(init);